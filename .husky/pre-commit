#!/bin/sh

# Exit on any error
set -e

echo "ğŸ” Running pre-commit checks..."

# Run linter
echo "ğŸ“ Running linter..."
npm run lint

# Build the project
echo "ğŸ”¨ Building project..."
npm run build

# Package the action
echo "ğŸ“¦ Packaging action..."
npm run package

# Check if dist/ changed
if [ -n "$(git diff --cached --name-only dist/)" ]; then
  echo "âœ… dist/ files are staged and will be committed"
elif [ -n "$(git diff --name-only dist/)" ]; then
  echo "âš ï¸  Warning: dist/ files have been updated but are not staged"
  echo "ğŸ“ Adding updated dist/ files to commit..."
  git add dist/
  echo "âœ… dist/ files have been added to the commit"
fi

echo "âœ… Pre-commit checks passed!"